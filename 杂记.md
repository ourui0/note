# æ‚è®°

## å•è°ƒæ ˆ

**å•è°ƒæ ˆ**æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ ˆï¼Œé‡Œé¢çš„å†…å®¹å•è°ƒï¼Œå®šä¹‰éå¸¸ç®€å•ï¼Œå’Œå®ƒçš„åå­—ç›¸åŒï¼Œä½†æ˜¯ä»–èƒ½ç”¨æ¥è§£å†³å¯»æ‰¾**ä¸‹ä¸€ä¸ªæ›´å¤§ï¼ˆæ›´å°ï¼‰**çš„å…ƒç´ 

è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ

æ¥ä¸‹æ¥ç”¨ä¸€ä¸ªç»å…¸ä¾‹å­æ¥è§£é‡Š

ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæ‰¾åˆ°å³è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒå¤§çš„æ•°

**è¾“å…¥**[2,1,2,4,3]

**è¾“å‡º**[4,2,4,-1,-1]

ç°åœ¨æˆ‘ä»¬æ¥æ¨¡æ‹Ÿè§£é¢˜è¿‡ç¨‹

1.åˆå§‹åŒ–ä¸€ä¸ªç©ºæ ˆï¼Œ

2.éå†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ 

3.å¯¹äºå½“å‰å…ƒç´ arr[i]:

+ **while** (æ ˆä¸ä¸ºç©º **å¹¶ä¸”** å½“å‰å…ƒç´  `nums[i]` > æ ˆé¡¶å…ƒç´ )ï¼š
  - **å¼¹å‡º**æ ˆé¡¶å…ƒç´ ã€‚è¿™æ„å‘³ç€ï¼š**å½“å‰å…ƒç´  `nums[i]` å°±æ˜¯è¢«å¼¹å‡ºå…ƒç´ çš„â€œä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ â€**ã€‚
  - æˆ‘ä»¬å°†è¿™ä¸ªå¯¹åº”å…³ç³»ï¼ˆè¢«å¼¹å‡ºå…ƒç´  -> `nums[i]`) è®°å½•ä¸‹æ¥ã€‚
+ **å°†**å½“å‰å…ƒç´  `nums[i]` çš„**ç´¢å¼•**ï¼ˆæˆ–å€¼ï¼‰å‹å…¥æ ˆä¸­ã€‚
+ ï¼ˆè¿™æ ·å°±èƒ½ä¿è¯æ ˆå†…å…ƒç´ ä»åº•åˆ°é¡¶å§‹ç»ˆæ˜¯**å•è°ƒé€’å‡**çš„ï¼‰ 

4.éå†ç»“æŸåï¼Œå¦‚æœæ ˆä¸­è¿˜æœ‰å…ƒç´ ï¼Œè¯´æ˜è¿™äº›å…ƒç´ å³è¾¹æ²¡æœ‰æ¯”å®ƒä»¬æ›´å¤§çš„å…ƒç´ ï¼Œå®ƒä»¬çš„ç»“æœè®°ä¸º -1ã€‚

**ä¸€æ­¥æ­¥æ‹†è§£ä¸Šé¢çš„æ•°ç»„ `[2, 1, 2, 4, 3]`ï¼š**

| å½“å‰å…ƒç´  | æ“ä½œ                                                         | æ ˆ (åº• -> é¡¶) | è¯´æ˜/ç»“æœè®°å½•                                               |
| :------- | :----------------------------------------------------------- | :------------ | :---------------------------------------------------------- |
| 2        | æ ˆç©ºï¼Œç›´æ¥å…¥æ ˆ                                               | [2]           |                                                             |
| 1        | 1 < æ ˆé¡¶(2)ï¼Œç›´æ¥å…¥æ ˆ                                        | [2, 1]        |                                                             |
| 2        | 2 > æ ˆé¡¶(1)ï¼Œ**å¼¹å‡º1**ï¼Œè®°å½• `1 -> 2` 2 == æ ˆé¡¶(2)ï¼Œ**å…¥æ ˆ** | [2, 2]        | 1 çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ æ˜¯ 2                                      |
| 4        | 4 > æ ˆé¡¶(2)ï¼Œ**å¼¹å‡º2**ï¼Œè®°å½• `2 -> 4` 4 > æ ˆé¡¶(2)ï¼Œ**å¼¹å‡º2**ï¼Œè®°å½• `2 -> 4` æ ˆç©ºï¼Œ**å…¥æ ˆ** | [4]           | ç¬¬äºŒä¸ª 2 çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ æ˜¯ 4 ç¬¬ä¸€ä¸ª 2 çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ æ˜¯ 4 |
| 3        | 3 < æ ˆé¡¶(4)ï¼Œç›´æ¥å…¥æ ˆ                                        | [4, 3]        |                                                             |
| **ç»“æŸ** | æ ˆä¸­å‰©ä½™å…ƒç´  [4, 3]ï¼Œå®ƒä»¬å³è¾¹æ²¡æœ‰æ›´å¤§å…ƒç´ ï¼Œè®°å½• `4 -> -1`, `3 -> -1` |               |                                                             |

**ä»£ç ç¤ºä¾‹**ï¼š

```c++
#include <iostream>
#include <vector>
#include <stack>
using namespace std;

vector<int> nextGreaterElement(const vector<int>& nums) {
    int n = nums.size();
    vector<int> result(n, -1); // åˆå§‹åŒ–ç»“æœæ•°ç»„ï¼Œå…¨éƒ¨ä¸º-1
    stack<int> st; // å•è°ƒæ ˆï¼Œå­˜å‚¨çš„æ˜¯å…ƒç´ çš„ç´¢å¼•
    
    // éå†æ•°ç»„
    for (int i = 0; i < n; i++) {
        // å½“æ ˆä¸ä¸ºç©ºä¸”å½“å‰å…ƒç´ å¤§äºæ ˆé¡¶å…ƒç´ å¯¹åº”çš„å€¼æ—¶
        while (!st.empty() && nums[i] > nums[st.top()]) {
            // æ ˆé¡¶å…ƒç´ çš„ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ å°±æ˜¯å½“å‰å…ƒç´ 
            result[st.top()] = nums[i];
            st.pop(); // å¼¹å‡ºæ ˆé¡¶å…ƒç´ 
        }
        // å°†å½“å‰å…ƒç´ çš„ç´¢å¼•å…¥æ ˆ
        st.push(i);
    }
    
    return result;
}

int main() {
    vector<int> nums = {2, 1, 2, 4, 3};
    vector<int> result = nextGreaterElement(nums);
    
    cout << "è¾“å…¥æ•°ç»„: ";
    for (int num : nums) {
        cout << num << " ";
    }
    cout << endl;
    
    cout << "ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ : ";
    for (int res : result) {
        cout << res << " ";
    }
    cout << endl;
    
    return 0;
}
```

## ææ„å‡½æ•°

### ğŸ“š åŸºæœ¬å®šä¹‰

**ææ„å‡½æ•°** æ˜¯ä¸€ç§ç‰¹æ®Šçš„æˆå‘˜å‡½æ•°ï¼Œå®ƒåœ¨å¯¹è±¡è¢«é”€æ¯æ—¶**è‡ªåŠ¨è°ƒç”¨**ï¼Œç”¨äºæ‰§è¡Œå¯¹è±¡çš„æ¸…ç†å·¥ä½œã€‚

#### ğŸ”§ è¯­æ³•å½¢å¼

```cpp
class ClassName {
public:
    ~ClassName();  // ææ„å‡½æ•°å£°æ˜
};

// ææ„å‡½æ•°å®šä¹‰
ClassName::~ClassName() {
    // æ¸…ç†ä»£ç 
}
```

---

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

#### 1. **å‘½åè§„åˆ™**
- å‡½æ•°å = `~` + ç±»å
- **æ— å‚æ•°**ï¼Œ**æ— è¿”å›å€¼**
- **ä¸èƒ½è¢«é‡è½½**ï¼ˆä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªææ„å‡½æ•°ï¼‰

#### 2. **è°ƒç”¨æ—¶æœº**
ææ„å‡½æ•°åœ¨ä»¥ä¸‹æƒ…å†µè‡ªåŠ¨è°ƒç”¨ï¼š

| åœºæ™¯                                  | ç¤ºä¾‹                          |
| ------------------------------------- | ----------------------------- |
| å±€éƒ¨å¯¹è±¡ç¦»å¼€ä½œç”¨åŸŸ                    | `{ MyClass obj; }` â† å³æ‹¬å·å¤„ |
| åŠ¨æ€å¯¹è±¡è¢« `delete`(ä¸èƒ½æ˜¯```free```) | `delete ptr;`                 |
| å¯¹è±¡æˆå‘˜æ‰€å±å¯¹è±¡é”€æ¯                  | åŒ…å«ç±»å¯¹è±¡é”€æ¯æ—¶              |
| ä¸´æ—¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸ                  | è¡¨è¾¾å¼è®¡ç®—å®Œæˆå              |
| æ ˆå±•å¼€æ—¶ï¼ˆå¼‚å¸¸å¤„ç†ï¼‰                  | å¼‚å¸¸æŠ›å‡ºæ—¶                    |

---

### ğŸ’» è¯¦ç»†ä»£ç ç¤ºä¾‹

#### ç¤ºä¾‹1ï¼šåŸºç¡€ç”¨æ³•

```cpp
#include <iostream>
#include <cstring>

class String {
private:
    char* m_data;
    size_t m_length;

public:
    // ğŸ—ï¸ æ„é€ å‡½æ•° - åˆ†é…èµ„æº
    String(const char* str = "") {
        std::cout << "ğŸ”§ æ„é€ å‡½æ•°è¢«è°ƒç”¨" << std::endl;
        m_length = strlen(str);
        m_data = new char[m_length + 1];  // ğŸ¯ åŠ¨æ€åˆ†é…å†…å­˜
        strcpy(m_data, str);
    }

    // ğŸ—‘ï¸ ææ„å‡½æ•° - é‡Šæ”¾èµ„æº
    ~String() {
        std::cout << "ğŸ§¹ ææ„å‡½æ•°è¢«è°ƒç”¨ï¼Œé‡Šæ”¾èµ„æº: " << (m_data ? m_data : "null") << std::endl;
        delete[] m_data;  // ğŸ¯ å…³é”®ï¼šé‡Šæ”¾åŠ¨æ€å†…å­˜
        m_data = nullptr;
    }

    // å…¶ä»–æˆå‘˜å‡½æ•°
    void print() const {
        std::cout << "å†…å®¹: " << m_data << std::endl;
    }
};

void demoBasic() {
    std::cout << "\n=== ç¤ºä¾‹1ï¼šåŸºç¡€ç”¨æ³• ===" << std::endl;
    { // å¼€å§‹ä½œç”¨åŸŸ
        String s1("Hello World");  // ğŸ—ï¸ æ„é€ å‡½æ•°è°ƒç”¨
        s1.print();
    } // ğŸ§¹ ç¦»å¼€ä½œç”¨åŸŸï¼Œææ„å‡½æ•°è‡ªåŠ¨è°ƒç”¨
    
    std::cout << "ä½œç”¨åŸŸç»“æŸ" << std::endl;
}
```

#### ç¤ºä¾‹2ï¼šåŠ¨æ€å¯¹è±¡ç®¡ç†

```cpp
class ResourceManager {
private:
    int* m_buffer;
    size_t m_size;

public:
    // æ„é€ å‡½æ•°
    ResourceManager(size_t size) : m_size(size) {
        std::cout << "ğŸ”§ åˆ†é… " << size << " ä¸ªæ•´æ•°" << std::endl;
        m_buffer = new int[size];  // ğŸ¯ åŠ¨æ€åˆ†é…
    }

    // ææ„å‡½æ•°
    ~ResourceManager() {
        std::cout << "ğŸ§¹ é‡Šæ”¾ " << m_size << " ä¸ªæ•´æ•°" << std::endl;
        delete[] m_buffer;  // ğŸ¯ é˜²æ­¢å†…å­˜æ³„æ¼
        m_buffer = nullptr;
    }

    // ç¦ç”¨æ‹·è´ï¼ˆé¿å…æµ…æ‹·è´é—®é¢˜ï¼‰
    ResourceManager(const ResourceManager&) = delete;
    ResourceManager& operator=(const ResourceManager&) = delete;
};

void demoDynamic() {
    std::cout << "\n=== ç¤ºä¾‹2ï¼šåŠ¨æ€å¯¹è±¡ ===" << std::endl;
    
    ResourceManager* ptr = new ResourceManager(100);  // ğŸ—ï¸ æ„é€ å‡½æ•°
    ptr->~ResourceManager();  // âŒ å¯ä»¥æ˜¾å¼è°ƒç”¨ï¼Œä½†é€šå¸¸ä¸åº”è¯¥è¿™æ ·åš
    delete ptr;  // ğŸ§¹ è°ƒç”¨ææ„å‡½æ•° + é‡Šæ”¾å†…å­˜
    
    std::cout << "åŠ¨æ€å¯¹è±¡å·²é”€æ¯" << std::endl;
}
```

#### ç¤ºä¾‹3ï¼šRAIIæ¨¡å¼

```cpp
#include <fstream>

// ğŸ¯ RAIIï¼ˆResource Acquisition Is Initializationï¼‰ç¤ºä¾‹
class FileWrapper {
private:
    std::fstream m_file;

public:
    // æ„é€ å‡½æ•°è·å–èµ„æº
    FileWrapper(const std::string& filename, std::ios::openmode mode = std::ios::in) {
        std::cout << "ğŸ”§ æ‰“å¼€æ–‡ä»¶: " << filename << std::endl;
        m_file.open(filename, mode);
        if (!m_file.is_open()) {
            throw std::runtime_error("æ— æ³•æ‰“å¼€æ–‡ä»¶");
        }
    }

    // ææ„å‡½æ•°é‡Šæ”¾èµ„æº
    ~FileWrapper() {
        std::cout << "ğŸ§¹ å…³é—­æ–‡ä»¶" << std::endl;
        if (m_file.is_open()) {
            m_file.close();  // ğŸ¯ ç¡®ä¿æ–‡ä»¶è¢«å…³é—­
        }
    }

    // ä½¿ç”¨èµ„æº
    std::string readLine() {
        std::string line;
        std::getline(m_file, line);
        return line;
    }

    // ç¦æ­¢æ‹·è´
    FileWrapper(const FileWrapper&) = delete;
    FileWrapper& operator=(const FileWrapper&) = delete;
};

void demoRAII() {
    std::cout << "\n=== ç¤ºä¾‹3ï¼šRAIIæ¨¡å¼ ===" << std::endl;
    
    try {
        FileWrapper file("example.txt");  // ğŸ—ï¸ èµ„æºè·å–
        auto content = file.readLine();   // ğŸ¯ ä½¿ç”¨èµ„æº
        std::cout << "è¯»å–å†…å®¹: " << content << std::endl;
    } // ğŸ§¹ æ— è®ºæ˜¯å¦å¼‚å¸¸ï¼Œæ–‡ä»¶éƒ½ä¼šè¢«æ­£ç¡®å…³é—­
    catch (const std::exception& e) {
        std::cout << "é”™è¯¯: " << e.what() << std::endl;
    }
}
```

---

### âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

#### 1. **è™šææ„å‡½æ•°**

```cpp
class Base {
public:
    // âœ… å¦‚æœç±»å¯èƒ½è¢«ç»§æ‰¿ï¼Œåº”è¯¥å£°æ˜è™šææ„å‡½æ•°
    virtual ~Base() {
        std::cout << "Base ææ„å‡½æ•°" << std::endl;
    }
};

class Derived : public Base {
private:
    int* m_data;
public:
    Derived() : m_data(new int[100]) {}
    
    // âœ… æ­£ç¡®ï¼šæ´¾ç”Ÿç±»ææ„å‡½æ•°è‡ªåŠ¨ä¸ºè™šå‡½æ•°
    ~Derived() override {
        std::cout << "Derived ææ„å‡½æ•°" << std::endl;
        delete[] m_data;
    }
};

void demoVirtualDestructor() {
    std::cout << "\n=== è™šææ„å‡½æ•°ç¤ºä¾‹ ===" << std::endl;
    
    Base* ptr = new Derived();
    delete ptr;  // ğŸ¯ æ­£ç¡®è°ƒç”¨ Derived å’Œ Base çš„ææ„å‡½æ•°
}
```

#### 2. **åˆæˆææ„å‡½æ•°**

å¦‚æœç±»æ²¡æœ‰å®šä¹‰ææ„å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªï¼š

```cpp
class SimpleClass {
    int x, y;
public:
    // ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆï¼š~SimpleClass() {}
    // å¯¹åŸºæœ¬ç±»å‹æˆå‘˜ï¼Œåˆæˆææ„å‡½æ•°ä»€ä¹ˆä¹Ÿä¸åš
};
```

---

### ğŸ”„ ä¸å…¶ä»–è¯­è¨€çš„å¯¹æ¯”

| è¯­è¨€       | ç±»ä¼¼æœºåˆ¶                | ç‰¹ç‚¹                     |
| ---------- | ----------------------- | ------------------------ |
| **C++**    | `~ClassName()`          | ç¡®å®šæ€§é”€æ¯ï¼Œæ‰‹åŠ¨å†…å­˜ç®¡ç† |
| **Java**   | `finalize()`            | âŒ å·²åºŸå¼ƒï¼Œéç¡®å®šæ€§è°ƒç”¨   |
| **C#**     | `IDisposable` + `using` | ç¡®å®šæ€§èµ„æºç®¡ç†           |
| **Python** | `__del__()`             | éç¡®å®šæ€§ï¼Œä¾èµ–åƒåœ¾å›æ”¶   |
| **Rust**   | `Drop trait`            | ç¡®å®šæ€§ï¼Œæ‰€æœ‰æƒç³»ç»Ÿ       |

---

### ğŸ¯ æœ€ä½³å®è·µæ€»ç»“

1. **âœ… RAIIåŸåˆ™**ï¼šåœ¨æ„é€ å‡½æ•°ä¸­è·å–èµ„æºï¼Œåœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾
2. **âœ… è™šææ„å‡½æ•°**ï¼šåŸºç±»å£°æ˜è™šææ„å‡½æ•°
3. **âœ… å¼‚å¸¸å®‰å…¨**ï¼šææ„å‡½æ•°ä¸åº”è¯¥æŠ›å‡ºå¼‚å¸¸
4. **âŒ é¿å…æ‰‹åŠ¨è°ƒç”¨**ï¼šé™¤éåœ¨placement newç­‰ç‰¹æ®Šåœºæ™¯
5. **âœ… éµå¾ªè§„åˆ™äº”**ï¼šå¦‚æœéœ€è¦è‡ªå®šä¹‰ææ„å‡½æ•°ï¼Œé€šå¸¸ä¹Ÿéœ€è¦æ‹·è´/ç§»åŠ¨æ§åˆ¶æˆå‘˜

```cpp
// ğŸ¯ ç°ä»£C++æ¨èï¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆé¿å…æ‰‹åŠ¨ææ„
#include <memory>

void modernCppStyle() {
    std::cout << "\n=== ç°ä»£C++é£æ ¼ ===" << std::endl;
    
    // æ— éœ€æ‰‹åŠ¨ deleteï¼Œunique_ptr è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
    auto ptr = std::make_unique<String>("Modern C++");
    ptr->print();
    
    std::cout << "ç¦»å¼€ä½œç”¨åŸŸï¼Œæ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨æ¸…ç†..." << std::endl;
} // ğŸ§¹ è‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°
```

---

### ğŸ“Š å¯è§†åŒ–ï¼šå¯¹è±¡ç”Ÿå‘½å‘¨æœŸ

```
å¯¹è±¡åˆ›å»º â†’ æ„é€ å‡½æ•° ğŸ—ï¸
    â†“
å¯¹è±¡ä½¿ç”¨æœŸ
    â†“
å¯¹è±¡é”€æ¯ â†’ ææ„å‡½æ•° ğŸ§¹
    â†“
èµ„æºé‡Šæ”¾ âœ…
```

**å…³é”®è¦ç‚¹**ï¼šææ„å‡½æ•°æ˜¯C++ä¸­èµ„æºç®¡ç†çš„åŸºçŸ³ï¼Œå®ƒç¡®ä¿äº†å¯¹è±¡åœ¨ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶èƒ½å¤Ÿæ­£ç¡®åœ°æ¸…ç†å…¶å ç”¨çš„èµ„æºï¼Œæ˜¯é˜²æ­¢èµ„æºæ³„æ¼çš„æ ¸å¿ƒæœºåˆ¶ã€‚